<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auditoría PPR TS FSSC 22002</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <style>
        /* Estilos previos se mantienen igual */
        /* ... (todo el CSS anterior) ... */
    </style>
</head>
<body>
    <!-- Login Section -->
    <section id="login" class="page-section active">
        <div class="login-container">
            <div class="login-card">
                <div class="login-logo">
                    <i class="fas fa-clipboard-check"></i>
                    <h1>Auditoría PPR</h1>
                </div>
                
                <div class="tabs">
                    <div class="tab active" data-tab="login">Iniciar Sesión</div>
                    <div class="tab" data-tab="register">Registrarse</div>
                </div>
                
                <div id="login-message"></div>
                
                <!-- Login Form -->
                <div id="login-form">
                    <div class="form-group">
                        <label for="login-email">Correo Electrónico</label>
                        <input type="email" id="login-email" placeholder="tucorreo@empresa.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="login-password">Contraseña</label>
                        <input type="password" id="login-password" placeholder="Ingresa tu contraseña">
                    </div>
                    
                    <button class="btn btn-primary" id="btn-login">
                        <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                    </button>
                </div>
                
                <!-- Registration Form -->
                <div id="register-form" style="display: none;">
                    <div class="form-group">
                        <label for="register-name">Nombre Completo</label>
                        <input type="text" id="register-name" placeholder="Ingresa tu nombre completo">
                    </div>
                    
                    <div class="form-group">
                        <label for="register-email">Correo Electrónico</label>
                        <input type="email" id="register-email" placeholder="tucorreo@empresa.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="register-password">Contraseña</label>
                        <input type="password" id="register-password" placeholder="Crea una contraseña segura">
                    </div>
                    
                    <div class="form-group">
                        <label for="register-confirm">Confirmar Contraseña</label>
                        <input type="password" id="register-confirm" placeholder="Repite tu contraseña">
                    </div>
                    
                    <button class="btn btn-success" id="btn-register">
                        <i class="fas fa-user-plus"></i> Crear Cuenta
                    </button>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Main App -->
    <div id="main-app" style="display: none;">
        <!-- ... (todo el HTML de la aplicación principal) ... -->
    </div>
    
    <script>
        // ... (código JavaScript anterior) ...
        
        // Login
        async function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const messageContainer = document.getElementById('login-message');
            
            if (!email || !password) {
                showMessage('Por favor completa todos los campos', 'error');
                return;
            }
            
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: "login",
                        email: email,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (data.status === "success") {
                    currentUser = data.user;
                    document.getElementById('user-name').textContent = currentUser.name || currentUser.email;
                    document.getElementById('login').classList.remove('active');
                    document.getElementById('main-app').style.display = 'block';
                    showPage('inicio');
                    
                    // LIMPIAR CAMPOS DE CONTRASEÑA DESPUÉS DEL LOGIN
                    document.getElementById('login-password').value = '';
                } else {
                    showMessage(data.message || "Credenciales incorrectas", 'error');
                }
            } catch (error) {
                showMessage('Error de conexión: ' + error.message, 'error');
            }
        }
        
        // ... (resto del código JavaScript) ...
    </script>
</body>
</html>
